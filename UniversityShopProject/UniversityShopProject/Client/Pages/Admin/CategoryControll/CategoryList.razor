@page "/Admin-CategoryList"
@inject HttpClient httpClient

@layout AdminLayout

<PageTitle>لیست دسته بندی‌ها</PageTitle>

<h3>لیست دسته بندی‌ها</h3>

<CategoryAddModal />
<table class="table table-bordered mt-3">
    <thead>
        <tr>
            <th scope="col" class="text-center">نام</th>
            <th scope="col" class="text-center">وضعیت فعال/غیرفعال</th>
            <th scope="col">زیردسته‌ها</th>
            <th colspan="2" class="text-center">گزینه‌ها</th>
        </tr>
    </thead>
    <tbody>
        @if (categories != null)
        {
            @foreach (var item in categories)
            {
                if (item.ParentId == null)
                {
                    <tr>
                        <td class="text-center">@item.CategoryName</td>
                        <td class="text-center">
                            @if (item.IsActive == true)
                            {
                                <span class="text-success">این دسته بندی فعال است.</span>
                            }
                            else
                            {
                                <span class="text-danger">این دسته بندی غیرفعال است.</span>

                            }
                        </td>
                        <td>
                            <ul style="direction:ltr !important;">
                                @foreach (var sub in categories)
                                {
                                    if (sub.ParentId == item.CategoryId)
                                    {
                                        <li class="my-2">
                                            @sub.CategoryName
                                            <br>
                                        </li>
                                    }
                                }
                            </ul>
                        </td>
                        <td class="text-center">
                            <NavLink href="@item.CInfoUrl">
                                <buttom class="btn btn-warning btn-sm btn-block px-0">
                                    مشاهده جزئیات و ویرایش
                                </buttom>
                            </NavLink>
                        </td>
                    </tr>
                }
            }
        }
        else
        {
            <tr>
                <td colspan="5" class="alert alert-danger text-center p-2">
                    دسته بندی یافت نشد.
                </td>
            </tr>
        }
    </tbody>
</table>



@code {
    private List<CategoryViewModel>? categories = new();
}
@functions{
    //این تابع در زمان لود شدن صفحه، اطلاعات را از کنترلر دریافت میکند
    protected override async Task OnInitializedAsync()
    {
        categories = await httpClient.GetFromJsonAsync<List<CategoryViewModel>>("Category/List");
        if (categories != null)
        {
            foreach (var item in categories)
            {
                item.CInfoUrl = "/Admin-CategoryInfo/" + item.CategoryId;
            }
        }
    }
}
